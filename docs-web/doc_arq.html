<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentação da Arquitetura</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-network-wired"></i>
                    <span>IoT Gateway · Arquitetura</span>
                </div>
                <nav class="main-nav">
                    <a href="../smart_ceu.html" class="nav-link" target="_top" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 16px; border-radius: 8px;">
                        <i class="fas fa-home"></i> Smart CEU
                    </a>
                    <a href="#home" class="nav-link active">Início</a>
                    <a href="#architecture" class="nav-link">Proposta Arquitetônica</a>
                    <a href="#technical" class="nav-link">Documentação Técnica</a>
                    <a href="#integrations" class="nav-link">Integrações</a>
                </nav>
                <div class="header-actions">
                    <select id="scopeSelector" class="scope-selector">
                        <option value="GLOBAL">Scope: GLOBAL</option>
                        <option value="BACKEND">Scope: BACKEND</option>
                        <option value="FRONTEND">Scope: FRONTEND</option>
                        <option value="SENSORS">Scope: SENSORS</option>
                    </select>
                    <button class="btn-export" onclick="exportDocs()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>PAGE TREE</h3>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-item" onclick="navigateTo('home')">
                    <i class="fas fa-home"></i> Bem-vindo
                </div>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Documentação Técnica</div>
                <div class="nav-item" onclick="navigateTo('architecture')">
                    <i class="fas fa-sitemap"></i> Proposta Arquitetônica
                </div>
                <div class="nav-item" onclick="navigateTo('solution-model')">
                    <i class="fas fa-cubes"></i> Modelo de Solução
                </div>
                <div class="nav-item" onclick="navigateTo('topology')">
                    <i class="fas fa-project-diagram"></i> Modelo de Topologia
                </div>
                <div class="nav-item" onclick="navigateTo('integrations')">
                    <i class="fas fa-plug"></i> Integrações
                </div>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Especificações</div>
                <div class="nav-item" onclick="navigateTo('api-specs')">
                    <i class="fas fa-code"></i> Especificações API
                </div>
                <div class="nav-item" onclick="navigateTo('data-model')">
                    <i class="fas fa-database"></i> Modelo de Dados
                </div>
                <div class="nav-item" onclick="navigateTo('security')">
                    <i class="fas fa-shield-alt"></i> Segurança
                </div>
                <div class="nav-item" onclick="navigateTo('operations')">
                    <i class="fas fa-cogs"></i> Operações
                </div>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Gestão</div>
                <div class="nav-item" onclick="navigateTo('checklist')">
                    <i class="fas fa-tasks"></i> Checklist / Intake
                </div>
                <div class="nav-item" onclick="navigateTo('endpoints')">
                    <i class="fas fa-exchange-alt"></i> Endpoints
                </div>
                <div class="nav-item" onclick="navigateTo('versioning')">
                    <i class="fas fa-code-branch"></i> Política de Versionado
                </div>
                <div class="nav-item" onclick="navigateTo('adrs')">
                    <i class="fas fa-file-alt"></i> ADRs
                </div>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Home Section -->
            <section id="home" class="content-section active">
                <div class="hero">
                    <h1>CEU Três Pontes · Sistema IoT Completo</h1>
                    <p class="hero-subtitle">Plataforma completa de monitoramento com API REST, banco de dados e autenticação JWT</p>
                    <div class="version-badge">v2.0.0 - Fase 3 Completa + Refatoração</div>
                </div>

                <div class="cards-grid">
                    <div class="card" onclick="navigateTo('architecture')">
                        <div class="card-icon">
                            <i class="fas fa-sitemap"></i>
                        </div>
                        <h3>Proposta Arquitetônica</h3>
                        <p>Visão geral da arquitetura do sistema, componentes e fluxos de dados</p>
                    </div>

                    <div class="card" onclick="navigateTo('solution-model')">
                        <div class="card-icon">
                            <i class="fas fa-cubes"></i>
                        </div>
                        <h3>Modelo de Solução</h3>
                        <p>Estrutura da solução, módulos e suas responsabilidades</p>
                    </div>

                    <div class="card" onclick="navigateTo('topology')">
                        <div class="card-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h3>Modelo de Topologia</h3>
                        <p>Topologia de rede, distribuição de componentes e infraestrutura</p>
                    </div>

                    <div class="card" onclick="navigateTo('integrations')">
                        <div class="card-icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <h3>Integrações</h3>
                        <p>Protocolos suportados: LoRa, Zigbee, Sigfox, RFID via MQTT</p>
                    </div>
                </div>

                <div class="info-section">
                    <h2>Sobre o Projeto</h2>
                    <p>Sistema completo de controle de acesso e contagem de pessoas para o CEU Três Pontes. Integra múltiplos protocolos IoT (LoRa, Zigbee, Sigfox, RFID) com API REST completa, banco de dados MySQL, autenticação JWT e arquitetura refatorada seguindo boas práticas (Clean Architecture, SOLID).</p>
                    
                    <div class="tech-stack">
                        <h3>Stack Tecnológico</h3>
                        <div class="tech-badges">
                            <span class="badge">Python 3.12</span>
                            <span class="badge">Flask 3.0</span>
                            <span class="badge">MySQL 8.4</span>
                            <span class="badge">SQLAlchemy</span>
                            <span class="badge">Marshmallow</span>
                            <span class="badge">JWT</span>
                            <span class="badge">MQTT / Mosquitto</span>
                            <span class="badge">REST API</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Architecture Section -->
            <section id="architecture" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Proposta Arquitetônica</span>
                </div>
                
                <h1>Proposta Arquitetônica</h1>
                <p class="section-intro">Visão completa da arquitetura do sistema IoT Gateway</p>

                <div class="content-card">
                    <h2><i class="fas fa-lightbulb"></i> Visão Geral</h2>
                    <p>O sistema IoT Gateway é uma solução modular para integração de múltiplos protocolos de sensores IoT, centralizando a comunicação através do protocolo MQTT e fornecendo uma interface unificada para processamento de dados.</p>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-layer-group"></i> Camadas da Arquitetura (5 Camadas)</h2>
                    
                    <div class="architecture-layer">
                        <h3>1. Camada de Sensores (Física)</h3>
                        <ul>
                            <li><strong>6 Sensores Ativos:</strong> LoRa (2), Zigbee (1), Sigfox (1), RFID (2)</li>
                            <li><strong>LoRa:</strong> Longo alcance, baixo consumo (Entrada Principal, Biblioteca)</li>
                            <li><strong>Zigbee:</strong> Redes mesh, automação (Quadra)</li>
                            <li><strong>Sigfox:</strong> Comunicação global (Refeitório)</li>
                            <li><strong>RFID:</strong> Identificação (Sala 101, Sala 102)</li>
                        </ul>
                    </div>

                    <div class="architecture-layer">
                        <h3>2. Camada de Gateway (IoT)</h3>
                        <ul>
                            <li><strong>MQTT Client (Paho):</strong> Publicação em sensores/+/dados</li>
                            <li><strong>Message Formatter:</strong> JSON padronizado com timestamp</li>
                            <li><strong>Config Loader:</strong> Leitura de mqtt_config.ini</li>
                            <li><strong>Gateway Core:</strong> Orquestração dos 6 sensores ativos</li>
                            <li><strong>6.026 mensagens publicadas</strong> desde início do sistema</li>
                        </ul>
                    </div>

                    <div class="architecture-layer">
                        <h3>3. Camada de Broker MQTT</h3>
                        <ul>
                            <li><strong>Eclipse Mosquitto 2.0.18:</strong> Broker local (localhost:1883)</li>
                            <li><strong>Topics:</strong> sensores/{protocol}/dados (lora, zigbee, sigfox, rfid)</li>
                            <li><strong>QoS Level 1:</strong> At least once delivery</li>
                            <li><strong>Subscriber:</strong> Gateway consome e persiste no MySQL</li>
                        </ul>
                    </div>

                    <div class="architecture-layer">
                        <h3>4. Camada de Backend (API REST)</h3>
                        <ul>
                            <li><strong>Flask 3.0:</strong> 29 endpoints REST ativos (localhost:5000)</li>
                            <li><strong>SQLAlchemy ORM:</strong> Mapeamento objeto-relacional</li>
                            <li><strong>Marshmallow:</strong> Validação e serialização (4 schemas)</li>
                            <li><strong>JWT Extended:</strong> Autenticação com tokens 24h</li>
                            <li><strong>Services Layer:</strong> Lógica de negócio isolada</li>
                            <li><strong>Utils Layer:</strong> Error handlers, decorators, validators</li>
                        </ul>
                    </div>

                    <div class="architecture-layer">
                        <h3>5. Camada de Dados (Persistência)</h3>
                        <ul>
                            <li><strong>MySQL 8.4.6:</strong> Banco relacional (localhost:3306)</li>
                            <li><strong>Database:</strong> ceu_tres_pontes_db</li>
                            <li><strong>5 Tabelas:</strong> sensors, readings, users, alerts, statistics</li>
                            <li><strong>6.026 leituras armazenadas</strong> com timestamps</li>
                            <li><strong>Índices otimizados:</strong> sensor_id, timestamp, activity</li>
                            <li><strong>JSON Fields:</strong> Metadados flexíveis (protocol_config, sensor_metadata)</li>
                        </ul>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-exchange-alt"></i> Fluxo de Dados Completo</h2>
                    <div class="flow-diagram">
                        <pre class="diagram">
┌─────────────┐
│  6 Sensores │  (LoRa, Zigbee, Sigfox, RFID)
└──────┬──────┘
       │ Coleta de dados físicos (activity, battery, signal)
       ▼
┌─────────────┐
│   Gateway   │  (Python + Paho MQTT)
└──────┬──────┘
       │ JSON: {sensor_id, activity, timestamp, metadata}
       ▼
┌─────────────┐
│ MQTT Broker │  (Mosquitto - Topics: sensores/{protocol}/dados)
└──────┬──────┘
       │ QoS 1 - At least once
       ▼
┌─────────────┐
│ Subscriber  │  (Gateway consume mensagens)
└──────┬──────┘
       │ Persiste via API interna
       ▼
┌─────────────┐
│  Flask API  │  (29 endpoints REST)
├─────────────┤
│  Services   │  (Business Logic)
├─────────────┤
│ SQLAlchemy  │  (ORM + Marshmallow)
└──────┬──────┘
       │ SQL Queries + Transactions
       ▼
┌─────────────┐
│   MySQL     │  (5 tabelas, 6.026 leituras)
└─────────────┘
       │
       ├──→ GET /api/v1/statistics/overview  (Analytics)
       ├──→ GET /api/v1/readings             (Query histórico)
       └──→ GET /api/v1/sensors              (Status sensores)
                        </pre>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-check-circle"></i> Características da Solução Completa</h2>
                    <ul class="features-list">
                        <li><i class="fas fa-check"></i> <strong>Multi-protocolo:</strong> 4 tipos de sensores IoT (LoRa, Zigbee, Sigfox, RFID)</li>
                        <li><i class="fas fa-check"></i> <strong>Comunicação assíncrona:</strong> MQTT com QoS 1</li>
                        <li><i class="fas fa-check"></i> <strong>API REST completa:</strong> 29 endpoints organizados em 5 categorias</li>
                        <li><i class="fas fa-check"></i> <strong>Banco de dados robusto:</strong> MySQL com 5 tabelas relacionais</li>
                        <li><i class="fas fa-check"></i> <strong>Autenticação JWT:</strong> Tokens seguros com validade de 24h</li>
                        <li><i class="fas fa-check"></i> <strong>Validação rigorosa:</strong> Marshmallow schemas em todas as entradas</li>
                        <li><i class="fas fa-check"></i> <strong>Arquitetura limpa:</strong> Services + Schemas + Utils (refatoração v2.0)</li>
                        <li><i class="fas fa-check"></i> <strong>6.026 leituras processadas:</strong> Sistema testado e operacional</li>
                        <li><i class="fas fa-check"></i> <strong>Monitoramento:</strong> Endpoint /health e estatísticas em tempo real</li>
                        <li><i class="fas fa-check"></i> <strong>Simuladores:</strong> Testes completos sem hardware físico</li>
                    </ul>
                </div>
            </section>

            <!-- Solution Model Section -->
            <section id="solution-model" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Modelo de Solução</span>
                </div>
                
                <h1>Modelo de Solução</h1>
                <p class="section-intro">Estrutura modular e componentes do sistema</p>

                <div class="content-card">
                    <h2><i class="fas fa-folder-tree"></i> Estrutura de Módulos</h2>
                    
                    <div class="module-card">
                        <h3>📦 Backend</h3>
                        <p><strong>Responsabilidade:</strong> Lógica de negócio e gerenciamento do gateway</p>
                        <ul>
                            <li><code>gateway.py</code> - Orquestrador principal do sistema</li>
                            <li><code>mqtt_client.py</code> - Cliente MQTT para comunicação</li>
                            <li><code>mqtt_subscriber.py</code> - Subscrição e processamento de mensagens</li>
                            <li><code>message_formatter.py</code> - Formatação de dados JSON</li>
                            <li><code>config_loader.py</code> - Carregamento de configurações</li>
                        </ul>
                    </div>

                    <div class="module-card">
                        <h3>📡 Sensores</h3>
                        <p><strong>Responsabilidade:</strong> Simulação e interface com sensores físicos</p>
                        <ul>
                            <li><code>base_sensor.py</code> - Classe abstrata base para todos os sensores</li>
                            <li><code>lora_sensor.py</code> - Implementação LoRa</li>
                            <li><code>zigbee_sensor.py</code> - Implementação Zigbee</li>
                            <li><code>sigfox_sensor.py</code> - Implementação Sigfox</li>
                            <li><code>rfid_sensor.py</code> - Implementação RFID</li>
                        </ul>
                    </div>

                    <div class="module-card">
                        <h3>⚙️ Configuração</h3>
                        <p><strong>Responsabilidade:</strong> Parâmetros e configurações do sistema</p>
                        <ul>
                            <li><code>mqtt_config.ini</code> - Configurações do broker MQTT</li>
                            <li><code>config.ini</code> - Configurações gerais do sistema</li>
                        </ul>
                    </div>

                    <div class="module-card">
                        <h3>🧪 Testes</h3>
                        <p><strong>Responsabilidade:</strong> Validação e testes do sistema</p>
                        <ul>
                            <li><code>test_mqtt_integration.py</code> - Testes de integração MQTT</li>
                            <li><code>test_simuladores.py</code> - Testes dos simuladores de sensores</li>
                            <li><code>exemplo_uso.py</code> - Exemplos de utilização</li>
                        </ul>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-puzzle-piece"></i> Padrões de Design</h2>
                    <ul>
                        <li><strong>Factory Pattern:</strong> Criação de sensores específicos</li>
                        <li><strong>Observer Pattern:</strong> MQTT pub/sub para eventos</li>
                        <li><strong>Singleton Pattern:</strong> Instância única do gateway</li>
                        <li><strong>Strategy Pattern:</strong> Diferentes estratégias de formatação</li>
                    </ul>
                </div>
            </section>

            <!-- Topology Section -->
            <section id="topology" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Modelo de Topologia</span>
                </div>
                
                <h1>Modelo de Topologia</h1>
                <p class="section-intro">Infraestrutura e distribuição de componentes</p>

                <div class="content-card">
                    <h2><i class="fas fa-network-wired"></i> Topologia de Rede</h2>
                    <div class="topology-diagram">
                        <pre>
┌─────────────────────────────────────────────────────────┐
│                    MQTT Broker                          │
│              (Eclipse Mosquitto)                        │
│                  localhost:1883                         │
└────────────┬────────────────────────────┬───────────────┘
             │                            │
    ┌────────▼────────┐          ┌───────▼────────┐
    │   Publishers    │          │  Subscribers   │
    │   (Gateway)     │          │  (Listeners)   │
    └────────┬────────┘          └────────────────┘
             │
    ┌────────▼────────────────────────────┐
    │         Sensor Layer                │
    │  ┌──────┬──────┬──────┬──────┐    │
    │  │ LoRa │Zigbee│Sigfox│ RFID │    │
    │  └──────┴──────┴──────┴──────┘    │
    └─────────────────────────────────────┘
                        </pre>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-server"></i> Componentes de Infraestrutura</h2>
                    
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Componente</th>
                                <th>Tecnologia</th>
                                <th>Porta/Protocolo</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>MQTT Broker</td>
                                <td>Eclipse Mosquitto 2.x</td>
                                <td>1883 (TCP)</td>
                                <td><span class="status-badge active">Ativo</span></td>
                            </tr>
                            <tr>
                                <td>Gateway Python</td>
                                <td>Python 3.x</td>
                                <td>-</td>
                                <td><span class="status-badge active">Ativo</span></td>
                            </tr>
                            <tr>
                                <td>Simuladores</td>
                                <td>Python Threads</td>
                                <td>-</td>
                                <td><span class="status-badge active">Ativo</span></td>
                            </tr>
                            <tr>
                                <td>API REST</td>
                                <td>Flask 3.0 + SQLAlchemy</td>
                                <td>5000 (HTTP)</td>
                                <td><span class="status-badge active">Ativo</span></td>
                            </tr>
                            <tr>
                                <td>Banco de Dados</td>
                                <td>MySQL 8.4</td>
                                <td>3306 (TCP)</td>
                                <td><span class="status-badge active">Ativo</span></td>
                            </tr>
                            <tr>
                                <td>Interface Web</td>
                                <td>HTML/JS/CSS (Test Page)</td>
                                <td>5000 (HTTP)</td>
                                <td><span class="status-badge active">Ativo</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Integrations Section -->
            <section id="integrations" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Integrações</span>
                </div>
                
                <h1>Integrações</h1>
                <p class="section-intro">Protocolos suportados e suas características</p>

                <div class="integration-grid">
                    <div class="integration-card lora">
                        <div class="integration-header">
                            <i class="fas fa-broadcast-tower"></i>
                            <h3>LoRa (Long Range)</h3>
                        </div>
                        <div class="integration-body">
                            <p><strong>Características:</strong></p>
                            <ul>
                                <li>Alcance: até 15 km (rural)</li>
                                <li>Frequência: 868 MHz (EU) / 915 MHz (US)</li>
                                <li>Taxa: 0.3 - 50 kbps</li>
                                <li>Consumo: Muito baixo</li>
                            </ul>
                            <p><strong>Uso:</strong> Sensores remotos, agricultura, smart cities</p>
                            <p><strong>Topic MQTT:</strong> <code>sensores/lora/dados</code></p>
                        </div>
                    </div>

                    <div class="integration-card zigbee">
                        <div class="integration-header">
                            <i class="fas fa-home"></i>
                            <h3>Zigbee</h3>
                        </div>
                        <div class="integration-body">
                            <p><strong>Características:</strong></p>
                            <ul>
                                <li>Alcance: 10-100 metros</li>
                                <li>Frequência: 2.4 GHz</li>
                                <li>Taxa: 250 kbps</li>
                                <li>Topologia: Mesh</li>
                            </ul>
                            <p><strong>Uso:</strong> Automação residencial, iluminação inteligente</p>
                            <p><strong>Topic MQTT:</strong> <code>sensores/zigbee/dados</code></p>
                        </div>
                    </div>

                    <div class="integration-card sigfox">
                        <div class="integration-header">
                            <i class="fas fa-globe"></i>
                            <h3>Sigfox</h3>
                        </div>
                        <div class="integration-body">
                            <p><strong>Características:</strong></p>
                            <ul>
                                <li>Alcance: até 50 km</li>
                                <li>Frequência: 868 MHz</li>
                                <li>Taxa: 100 bps</li>
                                <li>Mensagens: 140 msg/dia</li>
                            </ul>
                            <p><strong>Uso:</strong> Rastreamento, medição, alarmes</p>
                            <p><strong>Topic MQTT:</strong> <code>sensores/sigfox/dados</code></p>
                        </div>
                    </div>

                    <div class="integration-card rfid">
                        <div class="integration-header">
                            <i class="fas fa-id-card"></i>
                            <h3>RFID</h3>
                        </div>
                        <div class="integration-body">
                            <p><strong>Características:</strong></p>
                            <ul>
                                <li>Alcance: 0.1 - 10 metros</li>
                                <li>Frequência: 125 kHz - 2.4 GHz</li>
                                <li>Taxa: Instantânea</li>
                                <li>Sem bateria (passivo)</li>
                            </ul>
                            <p><strong>Uso:</strong> Controle de acesso, inventário, logística</p>
                            <p><strong>Topic MQTT:</strong> <code>sensores/rfid/dados</code></p>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-code"></i> Formato de Mensagem Padrão</h2>
                    <pre class="code-block"><code>{
  "tipo_sensor": "lora|zigbee|sigfox|rfid",
  "sensor_id": "unique_sensor_identifier",
  "timestamp": "2025-10-15T14:30:00Z",
  "dados": {
    "temperatura": 23.5,
    "umidade": 65.2,
    "bateria": 87
  },
  "metadata": {
    "localizacao": "Sala A",
    "versao": "1.0.0"
  }
}</code></pre>
                </div>
            </section>

            <!-- API Specs Section -->
            <section id="api-specs" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Especificações API</span>
                </div>
                
                <h1>Especificações API REST</h1>
                <p class="section-intro">29 Endpoints ativos - API completa com autenticação JWT</p>

                <div class="content-card">
                    <h2><i class="fas fa-check-circle"></i> Status</h2>
                    <div class="alert alert-success" style="background-color: #d4edda; border-color: #c3e6cb; color: #155724; padding: 1rem; border-radius: 0.25rem;">
                        <i class="fas fa-check-circle"></i>
                        <p><strong>API REST totalmente implementada e funcional!</strong> Fase 3 concluída com sucesso.</p>
                        <ul style="margin-top: 0.5rem;">
                            <li>✅ 29 endpoints ativos</li>
                            <li>✅ Autenticação JWT</li>
                            <li>✅ Validação Marshmallow</li>
                            <li>✅ MySQL + SQLAlchemy</li>
                            <li>✅ Arquitetura refatorada</li>
                        </ul>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-route"></i> Endpoints de Autenticação</h2>
                    
                    <div class="endpoint">
                        <div class="endpoint-method post">POST</div>
                        <div class="endpoint-path">/api/v1/auth/login</div>
                        <p>Autenticar usuário e obter token JWT</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method post">POST</div>
                        <div class="endpoint-path">/api/v1/auth/register</div>
                        <p>Registrar novo usuário no sistema</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/auth/me</div>
                        <p>Obter informações do usuário autenticado</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method post">POST</div>
                        <div class="endpoint-path">/api/v1/auth/change-password</div>
                        <p>Alterar senha do usuário</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/auth/users</div>
                        <p>Listar todos os usuários (admin only)</p>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-broadcast-tower"></i> Endpoints de Sensores</h2>
                    
                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/sensors</div>
                        <p>Listar todos os sensores (com filtros)</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/sensors/{id}</div>
                        <p>Obter detalhes de um sensor específico</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method post">POST</div>
                        <div class="endpoint-path">/api/v1/sensors</div>
                        <p>Criar novo sensor (requer autenticação)</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method put">PUT</div>
                        <div class="endpoint-path">/api/v1/sensors/{id}</div>
                        <p>Atualizar sensor existente</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method delete">DELETE</div>
                        <div class="endpoint-path">/api/v1/sensors/{id}</div>
                        <p>Deletar sensor (admin only)</p>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-chart-line"></i> Endpoints de Leituras</h2>
                    
                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/readings</div>
                        <p>Listar leituras com filtros (sensor, data, limit)</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method post">POST</div>
                        <div class="endpoint-path">/api/v1/readings</div>
                        <p>Criar nova leitura de sensor</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method post">POST</div>
                        <div class="endpoint-path">/api/v1/readings/bulk</div>
                        <p>Criar múltiplas leituras em lote</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/readings/{id}</div>
                        <p>Obter detalhes de uma leitura específica</p>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-chart-bar"></i> Endpoints de Estatísticas</h2>
                    
                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/statistics/overview</div>
                        <p>Visão geral do sistema (6 sensores, 6.000+ leituras)</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/statistics/activity</div>
                        <p>Estatísticas de atividade por período</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/statistics/sensors</div>
                        <p>Estatísticas individuais por sensor</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/api/v1/statistics/capacity</div>
                        <p>Estatísticas de capacidade e ocupação</p>
                    </div>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-heartbeat"></i> Endpoint de Saúde</h2>
                    
                    <div class="endpoint">
                        <div class="endpoint-method get">GET</div>
                        <div class="endpoint-path">/health</div>
                        <p>Verificar status de saúde do sistema</p>
                    </div>
                </div>
            </section>

            <!-- Data Model Section -->
            <section id="data-model" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Modelo de Dados</span>
                </div>
                
                <h1>Modelo de Dados MySQL</h1>
                <p class="section-intro">5 Tabelas relacionais com 6.000+ registros de leituras</p>

                <div class="content-card">
                    <h2><i class="fas fa-database"></i> Banco de Dados: ceu_tres_pontes_db</h2>
                    <p><strong>MySQL 8.4.6</strong> - Banco relacional com suporte a JSON</p>
                    
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Tabela</th>
                                <th>Registros</th>
                                <th>Descrição</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>sensors</td>
                                <td>6</td>
                                <td>Sensores IoT cadastrados</td>
                            </tr>
                            <tr>
                                <td>readings</td>
                                <td>6.026</td>
                                <td>Leituras dos sensores</td>
                            </tr>
                            <tr>
                                <td>users</td>
                                <td>1</td>
                                <td>Usuários do sistema</td>
                            </tr>
                            <tr>
                                <td>alerts</td>
                                <td>0</td>
                                <td>Alertas do sistema</td>
                            </tr>
                            <tr>
                                <td>statistics</td>
                                <td>0</td>
                                <td>Estatísticas agregadas</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-table"></i> Tabela: sensors</h2>
                    <pre class="code-block"><code>CREATE TABLE sensors (
  id INT PRIMARY KEY AUTO_INCREMENT,
  serial_number VARCHAR(50) UNIQUE NOT NULL,
  protocol ENUM('LoRa', 'ZigBee', 'Sigfox', 'RFID') NOT NULL,
  location VARCHAR(200) NOT NULL,
  description TEXT,
  status ENUM('active', 'inactive', 'maintenance', 'error') DEFAULT 'active',
  protocol_config JSON,
  firmware_version VARCHAR(20),
  battery_level INT,
  signal_strength INT,
  total_readings INT DEFAULT 0,
  last_reading_at DATETIME,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Exemplo de registro:
{
  "id": 1,
  "serial_number": "LORA-ENTRADA-01",
  "protocol": "LoRa",
  "location": "Entrada Principal",
  "status": "active",
  "battery_level": 87,
  "signal_strength": -75,
  "total_readings": 826
}</code></pre>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-table"></i> Tabela: readings</h2>
                    <pre class="code-block"><code>CREATE TABLE readings (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  sensor_id INT NOT NULL,
  activity SMALLINT NOT NULL,  -- 0 = nenhuma, 1 = detecção
  timestamp DATETIME NOT NULL,
  sensor_metadata JSON,        -- battery_level, signal_strength, etc
  message_id VARCHAR(100),
  gateway_id VARCHAR(50),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (sensor_id) REFERENCES sensors(id) ON DELETE CASCADE,
  INDEX idx_sensor_timestamp (sensor_id, timestamp),
  INDEX idx_timestamp_activity (timestamp, activity)
);

-- Exemplo de registro:
{
  "id": 1,
  "sensor_id": 1,
  "activity": 1,
  "timestamp": "2025-10-15T14:30:00",
  "sensor_metadata": {
    "battery_level": 85,
    "signal_strength": -72,
    "temperature": 23.5
  }
}</code></pre>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-table"></i> Tabela: users</h2>
                    <pre class="code-block"><code>CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  full_name VARCHAR(100),
  phone VARCHAR(20),
  role ENUM('admin', 'operator', 'viewer') DEFAULT 'operator',
  is_active BOOLEAN DEFAULT TRUE,
  is_verified BOOLEAN DEFAULT FALSE,
  last_login DATETIME,
  login_count INT DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Usuário padrão:
{
  "username": "admin",
  "email": "admin@ceutrespontes.com",
  "role": "admin",
  "login_count": 14
}</code></pre>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-code-branch"></i> Relacionamentos</h2>
                    <ul>
                        <li><strong>sensors → readings:</strong> Um sensor tem muitas leituras (1:N)</li>
                        <li><strong>sensors → alerts:</strong> Um sensor pode ter muitos alertas (1:N)</li>
                        <li><strong>Cascade Delete:</strong> Ao deletar sensor, deleta leituras e alertas</li>
                        <li><strong>JSON Fields:</strong> protocol_config e sensor_metadata para dados flexíveis</li>
                    </ul>
                </div>
            </section>

            <!-- Security Section -->
            <section id="security" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Segurança</span>
                </div>
                
                <h1>Segurança</h1>
                <p class="section-intro">Sistema completo com autenticação JWT e validação em múltiplas camadas</p>

                <div class="content-card">
                    <h2><i class="fas fa-lock"></i> Autenticação e Autorização</h2>
                    <ul class="security-list">
                        <li><i class="fas fa-check-circle"></i> <strong>JWT (JSON Web Tokens):</strong> Tokens com validade de 24 horas</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Bcrypt Password Hashing:</strong> Senhas criptografadas com salt</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Role-Based Access:</strong> 3 níveis (admin, operator, viewer)</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Protected Endpoints:</strong> @token_required decorator em rotas sensíveis</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Session Management:</strong> Controle de login_count e last_login</li>
                    </ul>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-shield-alt"></i> Validação de Dados</h2>
                    <ul class="security-list">
                        <li><i class="fas fa-check-circle"></i> <strong>Marshmallow Schemas:</strong> Validação estrita de entrada (4 schemas)</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Input Sanitization:</strong> @validate_request decorator personalizado</li>
                        <li><i class="fas fa-check-circle"></i> <strong>SQL Injection Prevention:</strong> SQLAlchemy ORM com prepared statements</li>
                        <li><i class="fas fa-check-circle"></i> <strong>JSON Validation:</strong> Formato de mensagens MQTT e API</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Email Validation:</strong> Formato RFC-compliant</li>
                    </ul>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-network-wired"></i> Segurança de Infraestrutura</h2>
                    <ul class="security-list">
                        <li><i class="fas fa-check-circle"></i> <strong>MQTT Local Network:</strong> Comunicação broker em rede local</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Database Security:</strong> Conexões autenticadas, usuário dedicado</li>
                        <li><i class="fas fa-check-circle"></i> <strong>Error Handling:</strong> Mensagens genéricas, logs detalhados</li>
                        <li><i class="fas fa-check-circle"></i> <strong>CORS Configuration:</strong> Controle de origens permitidas</li>
                    </ul>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-clock"></i> Melhorias Futuras</h2>
                    <ul class="security-list">
                        <li><i class="fas fa-hourglass-half"></i> TLS/SSL para MQTT (criptografia de transporte)</li>
                        <li><i class="fas fa-hourglass-half"></i> Rate Limiting (prevenção de abuso de API)</li>
                        <li><i class="fas fa-hourglass-half"></i> Audit Logs (rastreamento completo de ações)</li>
                        <li><i class="fas fa-hourglass-half"></i> Two-Factor Authentication (2FA)</li>
                        <li><i class="fas fa-hourglass-half"></i> API Key Management (autenticação adicional)</li>
                    </ul>
                </div>
            </section>

            <!-- Operations Section -->
            <section id="operations" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Operações</span>
                </div>
                
                <h1>Operações</h1>
                <p class="section-intro">Sistema completo rodando - API Flask + MySQL + MQTT Gateway</p>

                <div class="content-card">
                    <h2><i class="fas fa-play-circle"></i> Inicialização do Sistema Completo</h2>
                    <ol>
                        <li><strong>Ativar ambiente virtual:</strong> 
                            <pre class="code-block"><code>venv\Scripts\activate</code></pre>
                        </li>
                        <li><strong>Iniciar broker Mosquitto:</strong> 
                            <pre class="code-block"><code>mosquitto -v</code></pre>
                        </li>
                        <li><strong>Iniciar Gateway MQTT:</strong> 
                            <pre class="code-block"><code>python backend/gateway/gateway.py</code></pre>
                        </li>
                        <li><strong>Iniciar API Flask:</strong> 
                            <pre class="code-block"><code>cd backend
python app.py</code></pre>
                            <p><small>API disponível em: <code>http://localhost:5000</code></small></p>
                        </li>
                    </ol>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-database"></i> Gerenciamento do Banco de Dados</h2>
                    <ol>
                        <li><strong>Criar banco e usuário MySQL:</strong>
                            <pre class="code-block"><code>CREATE DATABASE ceu_tres_pontes_db;
CREATE USER 'ceu_user'@'localhost' IDENTIFIED BY 'sua_senha';
GRANT ALL PRIVILEGES ON ceu_tres_pontes_db.* TO 'ceu_user'@'localhost';</code></pre>
                        </li>
                        <li><strong>Configurar credenciais:</strong> 
                            <p>Editar <code>backend/config.py</code> com suas credenciais MySQL</p>
                        </li>
                        <li><strong>Criar tabelas:</strong> 
                            <p>As tabelas são criadas automaticamente no primeiro run com <code>db.create_all()</code></p>
                        </li>
                    </ol>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-vial"></i> Testes e Simulação</h2>
                    <pre class="code-block"><code># Executar testes unitários
python -m pytest tests/ -v

# Simular sensores enviando dados via MQTT
python tests/test_simuladores.py

# Testar integração MQTT completa
python tests/test_mqtt_integration.py</code></pre>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-tools"></i> Monitoramento em Produção</h2>
                    <ul>
                        <li><strong>Health Check:</strong> <code>GET /health</code> - Verifica status API e banco</li>
                        <li><strong>Logs Flask:</strong> Saída padrão do app.py (INFO, WARNING, ERROR)</li>
                        <li><strong>Logs Mosquitto:</strong> Console do broker com flag <code>-v</code></li>
                        <li><strong>Logs Gateway:</strong> Saída padrão do gateway.py</li>
                        <li><strong>Estatísticas:</strong> <code>GET /api/v1/statistics/overview</code> - Visão geral do sistema</li>
                        <li><strong>MySQL Monitoring:</strong> 
                            <pre class="code-block"><code>SELECT COUNT(*) FROM readings;  -- Total de leituras
SELECT * FROM sensors WHERE status='active';  -- Sensores ativos</code></pre>
                        </li>
                    </ul>
                </div>

                <div class="content-card">
                    <h2><i class="fas fa-user-shield"></i> Primeiro Login</h2>
                    <ol>
                        <li><strong>Registrar usuário admin:</strong>
                            <pre class="code-block"><code>POST /api/v1/auth/register
{
  "username": "admin",
  "email": "admin@ceutrespontes.com",
  "password": "SenhaSegura123!",
  "full_name": "Administrador",
  "role": "admin"
}</code></pre>
                        </li>
                        <li><strong>Fazer login:</strong>
                            <pre class="code-block"><code>POST /api/v1/auth/login
{
  "username": "admin",
  "password": "SenhaSegura123!"
}

# Retorna:
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "Bearer"
}</code></pre>
                        </li>
                        <li><strong>Usar token nas requisições:</strong>
                            <pre class="code-block"><code>Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...</code></pre>
                        </li>
                    </ol>
                </div>
            </section>

            <!-- Other sections placeholders -->
            <section id="checklist" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Checklist</span>
                </div>
                <h1>Checklist / Intake</h1>
                <p>Checklists de implementação e validação do projeto.</p>
            </section>

            <section id="endpoints" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Endpoints</span>
                </div>
                <h1>Endpoints</h1>
                <p>Documentação detalhada de todos os endpoints da API.</p>
            </section>

            <section id="versioning" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>Política de Versionado</span>
                </div>
                <h1>Política de Versionado</h1>
                <p>Estratégia de versionamento do sistema (Semantic Versioning).</p>
            </section>

            <section id="adrs" class="content-section">
                <div class="breadcrumb">
                    <a href="#home">Início</a> / <span>ADRs</span>
                </div>
                <h1>Architecture Decision Records</h1>
                <p>Registro de decisões arquiteturais importantes.</p>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 IoT Gateway Project · Documentação Arquitetônica v1.0.0</p>
            <p>Última atualização: 20 de Outubro de 2025</p>
        </div>
    </footer>

    <script src="assets/js/main.js"></script>
</body>
</html>
